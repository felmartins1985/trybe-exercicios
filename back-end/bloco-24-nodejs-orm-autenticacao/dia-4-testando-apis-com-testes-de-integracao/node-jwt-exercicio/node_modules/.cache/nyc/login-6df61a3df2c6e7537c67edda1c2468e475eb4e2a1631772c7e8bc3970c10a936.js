function cov_1ndjgk7ylp(){var path="/home/hp/trybe/trybe-exercicios/back-end/bloco-24-nodejs-orm-autenticacao/dia-4-testando-apis-com-testes-de-integracao/nodejs-jwt-base-project/controllers/login.js";var hash="2ed020b16c0c654c9f186e2c26cdf3e007b9ac2c";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/hp/trybe/trybe-exercicios/back-end/bloco-24-nodejs-orm-autenticacao/dia-4-testando-apis-com-testes-de-integracao/nodejs-jwt-base-project/controllers/login.js",statementMap:{"0":{start:{line:1,column:17},end:{line:1,column:37}},"1":{start:{line:3,column:21},end:{line:14,column:1}},"2":{start:{line:4,column:33},end:{line:4,column:37}},"3":{start:{line:6,column:2},end:{line:11,column:3}},"4":{start:{line:7,column:4},end:{line:9,column:74}},"5":{start:{line:10,column:4},end:{line:10,column:17}},"6":{start:{line:13,column:2},end:{line:13,column:14}},"7":{start:{line:16,column:0},end:{line:35,column:2}},"8":{start:{line:17,column:2},end:{line:34,column:3}},"9":{start:{line:18,column:35},end:{line:18,column:43}},"10":{start:{line:20,column:4},end:{line:20,column:45}},"11":{start:{line:20,column:38},end:{line:20,column:45}},"12":{start:{line:22,column:17},end:{line:22,column:60}},"13":{start:{line:24,column:4},end:{line:28,column:5}},"14":{start:{line:25,column:6},end:{line:27,column:67}},"15":{start:{line:29,column:4},end:{line:29,column:75}},"16":{start:{line:31,column:4},end:{line:33,column:61}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:3,column:21},end:{line:3,column:22}},loc:{start:{line:3,column:36},end:{line:14,column:1}},line:3},"1":{name:"(anonymous_1)",decl:{start:{line:16,column:17},end:{line:16,column:18}},loc:{start:{line:16,column:37},end:{line:35,column:1}},line:16}},branchMap:{"0":{loc:{start:{line:6,column:2},end:{line:11,column:3}},type:"if",locations:[{start:{line:6,column:2},end:{line:11,column:3}},{start:{line:6,column:2},end:{line:11,column:3}}],line:6},"1":{loc:{start:{line:6,column:6},end:{line:6,column:28}},type:"binary-expr",locations:[{start:{line:6,column:6},end:{line:6,column:15}},{start:{line:6,column:19},end:{line:6,column:28}}],line:6},"2":{loc:{start:{line:20,column:4},end:{line:20,column:45}},type:"if",locations:[{start:{line:20,column:4},end:{line:20,column:45}},{start:{line:20,column:4},end:{line:20,column:45}}],line:20},"3":{loc:{start:{line:24,column:4},end:{line:28,column:5}},type:"if",locations:[{start:{line:24,column:4},end:{line:28,column:5}},{start:{line:24,column:4},end:{line:28,column:5}}],line:24},"4":{loc:{start:{line:24,column:8},end:{line:24,column:43}},type:"binary-expr",locations:[{start:{line:24,column:8},end:{line:24,column:13}},{start:{line:24,column:17},end:{line:24,column:43}}],line:24}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"2ed020b16c0c654c9f186e2c26cdf3e007b9ac2c"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1ndjgk7ylp=function(){return actualCoverage;};}return actualCoverage;}cov_1ndjgk7ylp();const{User}=(cov_1ndjgk7ylp().s[0]++,require('../models'));cov_1ndjgk7ylp().s[1]++;const validateBody=(body,res)=>{cov_1ndjgk7ylp().f[0]++;const{username,password}=(cov_1ndjgk7ylp().s[2]++,body);cov_1ndjgk7ylp().s[3]++;if((cov_1ndjgk7ylp().b[1][0]++,!username)||(cov_1ndjgk7ylp().b[1][1]++,!password)){cov_1ndjgk7ylp().b[0][0]++;cov_1ndjgk7ylp().s[4]++;res.status(401).json({message:'É necessário usuário e senha para fazer login'});cov_1ndjgk7ylp().s[5]++;return false;}else{cov_1ndjgk7ylp().b[0][1]++;}cov_1ndjgk7ylp().s[6]++;return true;};cov_1ndjgk7ylp().s[7]++;module.exports=async(req,res)=>{cov_1ndjgk7ylp().f[1]++;cov_1ndjgk7ylp().s[8]++;try{const{username,password}=(cov_1ndjgk7ylp().s[9]++,req.body);cov_1ndjgk7ylp().s[10]++;if(!validateBody(req.body,res)){cov_1ndjgk7ylp().b[2][0]++;cov_1ndjgk7ylp().s[11]++;return;}else{cov_1ndjgk7ylp().b[2][1]++;}const user=(cov_1ndjgk7ylp().s[12]++,await User.findOne({where:{username}}));cov_1ndjgk7ylp().s[13]++;if((cov_1ndjgk7ylp().b[4][0]++,!user)||(cov_1ndjgk7ylp().b[4][1]++,user.password!==password)){cov_1ndjgk7ylp().b[3][0]++;cov_1ndjgk7ylp().s[14]++;return res.status(401).json({message:'Usuário não existe ou senha inválida'});}else{cov_1ndjgk7ylp().b[3][1]++;}cov_1ndjgk7ylp().s[15]++;return res.status(200).json({message:'Login efetuado com sucesso'});}catch(err){cov_1ndjgk7ylp().s[16]++;return res.status(500).json({message:'Erro interno',error:err.message});}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxvZ2luLmpzIl0sIm5hbWVzIjpbIlVzZXIiLCJyZXF1aXJlIiwidmFsaWRhdGVCb2R5IiwiYm9keSIsInJlcyIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJzdGF0dXMiLCJqc29uIiwibWVzc2FnZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJyZXEiLCJ1c2VyIiwiZmluZE9uZSIsIndoZXJlIiwiZXJyIiwiZXJyb3IiXSwibWFwcGluZ3MiOiI0bUdBZVk7MkZBZlosS0FBTSxDQUFFQSxJQUFGLDJCQUFXQyxPQUFPLENBQUMsV0FBRCxDQUFsQixDQUFOLEMsd0JBRUEsS0FBTUMsQ0FBQUEsWUFBWSxDQUFHLENBQUNDLElBQUQsQ0FBT0MsR0FBUCxHQUFlLHlCQUNsQyxLQUFNLENBQUVDLFFBQUYsQ0FBWUMsUUFBWiwyQkFBeUJILElBQXpCLENBQU4sQ0FEa0Msd0JBR2xDLEdBQUksNkJBQUNFLFFBQUQsK0JBQWEsQ0FBQ0MsUUFBZCxDQUFKLENBQTRCLG9EQUMxQkYsR0FBRyxDQUNBRyxNQURILENBQ1UsR0FEVixFQUVHQyxJQUZILENBRVEsQ0FBRUMsT0FBTyxDQUFFLCtDQUFYLENBRlIsRUFEMEIsd0JBSTFCLE1BQU8sTUFBUCxDQUNELENBTEQsaUNBSGtDLHdCQVVsQyxNQUFPLEtBQVAsQ0FDRCxDQVhELEMsd0JBYUFDLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixNQUFPQyxHQUFQLENBQVlSLEdBQVosR0FBb0IsaURBQ25DLEdBQUksQ0FDRixLQUFNLENBQUVDLFFBQUYsQ0FBWUMsUUFBWiwyQkFBeUJNLEdBQUcsQ0FBQ1QsSUFBN0IsQ0FBTixDQURFLHlCQUdGLEdBQUksQ0FBQ0QsWUFBWSxDQUFDVSxHQUFHLENBQUNULElBQUwsQ0FBV0MsR0FBWCxDQUFqQixDQUFrQyw0REFBTyxDQUF6QyxpQ0FFQSxLQUFNUyxDQUFBQSxJQUFJLDJCQUFHLEtBQU1iLENBQUFBLElBQUksQ0FBQ2MsT0FBTCxDQUFhLENBQUVDLEtBQUssQ0FBRSxDQUFFVixRQUFGLENBQVQsQ0FBYixDQUFULENBQVYsQ0FMRSx5QkFPRixHQUFJLDZCQUFDUSxJQUFELCtCQUFTQSxJQUFJLENBQUNQLFFBQUwsR0FBa0JBLFFBQTNCLENBQUosQ0FBeUMscURBQ3ZDLE1BQU9GLENBQUFBLEdBQUcsQ0FDUEcsTUFESSxDQUNHLEdBREgsRUFFSkMsSUFGSSxDQUVDLENBQUVDLE9BQU8sQ0FBRSxzQ0FBWCxDQUZELENBQVAsQ0FHRCxDQUpELGlDQVBFLHlCQVlGLE1BQU9MLENBQUFBLEdBQUcsQ0FBQ0csTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCLENBQUVDLE9BQU8sQ0FBRSw0QkFBWCxDQUFyQixDQUFQLENBQ0QsQ0FBQyxNQUFPTyxHQUFQLENBQVksMEJBQ1osTUFBT1osQ0FBQUEsR0FBRyxDQUNQRyxNQURJLENBQ0csR0FESCxFQUVKQyxJQUZJLENBRUMsQ0FBRUMsT0FBTyxDQUFFLGNBQVgsQ0FBMkJRLEtBQUssQ0FBRUQsR0FBRyxDQUFDUCxPQUF0QyxDQUZELENBQVAsQ0FHRCxDQUNGLENBbkJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBVc2VyIH0gPSByZXF1aXJlKCcuLi9tb2RlbHMnKTtcblxuY29uc3QgdmFsaWRhdGVCb2R5ID0gKGJvZHksIHJlcykgPT4ge1xuICBjb25zdCB7IHVzZXJuYW1lLCBwYXNzd29yZCB9ID0gYm9keTtcblxuICBpZiAoIXVzZXJuYW1lIHx8ICFwYXNzd29yZCkge1xuICAgIHJlc1xuICAgICAgLnN0YXR1cyg0MDEpXG4gICAgICAuanNvbih7IG1lc3NhZ2U6ICfDiSBuZWNlc3PDoXJpbyB1c3XDoXJpbyBlIHNlbmhhIHBhcmEgZmF6ZXIgbG9naW4nIH0pO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IHVzZXJuYW1lLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7XG4gICAgXG4gICAgaWYgKCF2YWxpZGF0ZUJvZHkocmVxLmJvZHksIHJlcykpIHJldHVybjtcblxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoeyB3aGVyZTogeyB1c2VybmFtZSB9IH0pO1xuICBcbiAgICBpZiAoIXVzZXIgfHwgdXNlci5wYXNzd29yZCAhPT0gcGFzc3dvcmQpIHtcbiAgICAgIHJldHVybiByZXNcbiAgICAgICAgLnN0YXR1cyg0MDEpXG4gICAgICAgIC5qc29uKHsgbWVzc2FnZTogJ1VzdcOhcmlvIG7Do28gZXhpc3RlIG91IHNlbmhhIGludsOhbGlkYScgfSk7XG4gICAgfVxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IG1lc3NhZ2U6ICdMb2dpbiBlZmV0dWFkbyBjb20gc3VjZXNzbycgfSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiByZXNcbiAgICAgIC5zdGF0dXMoNTAwKVxuICAgICAgLmpzb24oeyBtZXNzYWdlOiAnRXJybyBpbnRlcm5vJywgZXJyb3I6IGVyci5tZXNzYWdlIH0pO1xuICB9XG59O1xuIl19